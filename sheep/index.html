<!doctype html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <title>Jacob's Sheep Manager</title>
       
        <style type="text/css">
            html{
                width:100%;
                height:100%;
            }
            body{
                background-color:#41980a;
                margin:0;
                padding:0;
                width:100%;
                height:100%;

            }

             #containerDiv{
                width:100%;
                height:100%;
            }
            
            #gridDiv{
                padding-top:1em;
                aspect-ratio: 1;
                margin: 0 auto;
                
            }


            .altlist li:nth-child(even) {
                background-color:#dfdfdf
            }
            

            @media (max-aspect-ratio: 1/1) {
                #gridDiv{
               
                width:100%;
               
                }
            }

            @media (aspect-ratio: 1/1) {
                #gridDiv{
                    width:100%;
            
                }
            }

            @media (min-aspect-ratio: 1/1) {

              
                #gridDiv{
                    
                    height:90%;
                    
                   
                }

            }
        
           
      

        </style>
         <link rel="stylesheet" href="style.css" />
    </head>
    <body>
        <div id="containerDiv">
            <div id="gridDiv">
                <div class="window" style="width:100%;height:100%;position:relative;">
                    <div class="title-bar">
                      <div class="title-bar-text">Jacob's Sheep Manager</div>
                    </div>
                    <div class="window-body"  >
                <BR>
                        <menu role="tablist" id="tmenu">
                          <li role="tab" aria-selected="true"><a href="#" onclick="clickTab(0);">Farm Overview</a></li>
                          <li role="tab"><a href="#" onclick="clickTab(1);">Pasture Manager</a></li>
                          <li role="tab"><a href="#" onclick="clickTab(2);">Sheep Status</a></li>
                          <li role="tab"><a href="#" onclick="clickTab(3);">Market</a></li>
                          
                      
                        </menu>
                        <div class="window" role="tabpanel">
                          <div class="window-body" id="tabbody" style="padding:1em;z-index: 1;">
<!-- begin tab view-->





                    <!-- end tab view-->
                          </div>
                        </div><hr>
<!-- end window content-->
                    </div>
                    <div class="status-bar" style="z-index: 0;">
                      <p class="status-bar-field">GenesOS 30.29-30.43</p>
                      <p class="status-bar-field" id="scount">Total Sheep:</p>
                      <p class="status-bar-field" style="text-align:right">Registered to Laban</p>
                    </div>
                  </div>
            </div>
        </div>
    <script>
    //vars
    

   var gd;
   var tb = document.getElementById("tabbody");
   var tm = document.getElementById("tmenu");
   var sc = document.getElementById("scount");

    //main
    
    init();

    function init(){
       
       
        game();
        clickTab(0);
    }



    function game(){
       gd = new gameData();
       addNewSheep();
       addNewSheep();
       addNewSheep();
       gd.curPid = 1;
       addNewSheep();
       gd.curPid = 0;
      breedSheep(gd.sheeps[0],gd.sheeps[1]);
       

    }

    function clickTab(tid){
        tb.innerHTML = "";
       
        for (let t of tm.children){
            t.ariaSelected = false;
        }
        tm.children[tid].ariaSelected = true;

        switch (tid) {
            case 0:
                tb.innerHTML = tid;
                renderFarmOverview();
                break;
            case 1:
                tb.innerHTML = tid;
                renderPastureView();
                break;
            case 2:
               renderSheepView();
                break;
            case 3:
               tb.innerHTML = tid;
                break;
            case 4:
               tb.innerHTML = tid;
                break;
            case 5:
                tb.innerHTML = tid;
                break;
            }

        tb.innerHTML += "<BR><BR>";

    }

    function selectandviewsheep(sid){
        gd.curSid = sid;
        clickTab(2);
    }

    function selectandviewpasture(pid){
        gd.curPid = pid;
        clickTab(1);
    }

    function renderFarmOverview(){
        var out = "";
        out += renderAllSheepList();
        tb.innerHTML = out;
        return out;
    }
    function changePastureMenu(npi){
       
      
        gd.curPid = npi;
        renderPastureView();
    }

    function prevpast(){
        gd.curPid -= 1;
        if (gd.curPid < 0) gd.curPid = 3;
        renderPastureView();
    }

    function nextpast(){
        gd.curPid += 1;
        if (gd.curPid > 3) gd.curPid = 0;
        renderPastureView();
    }

    function nextsheep(){
        var bsid = gd.pastures[gd.sheeps[gd.curSid].pid].heldSheepIds.indexOf(gd.curSid);
        bsid += 1;
        if (bsid > (gd.pastures[gd.sheeps[gd.curSid].pid].heldSheepIds.length -1)) bsid = 0;
        gd.curSid =  gd.pastures[gd.sheeps[gd.curSid].pid].heldSheepIds[bsid];
        renderSheepView();

    }

    function prevsheep(){
        var bsid = gd.pastures[gd.sheeps[gd.curSid].pid].heldSheepIds.indexOf(gd.curSid);
        bsid -= 1;
        if (bsid < 0) bsid = (gd.pastures[gd.sheeps[gd.curSid].pid].heldSheepIds.length - 1);
        gd.curSid =  gd.pastures[gd.sheeps[gd.curSid].pid].heldSheepIds[bsid];
        renderSheepView();
    }

    function changeSheepPastureMenu(){
        var psm = document.getElementById("pmselector");
        moveSheep(gd.curSid,psm.selectedIndex);
    }

    function renderPastureView(){
        var out = ` <input id='pname' type='text' value='` + gd.pastures[gd.curPid].name + `' onchange='renamepasture()' /> - 
        <button onclick='prevpast()'>prev</button><button onclick="nextpast()">next</button>
        <BR><HR><BR>Sheep in pasture:<BR>`;

        out += renderPastureList(gd.curPid);
        tb.innerHTML = out;
        return out;
    }

    function renderSheepView(){
        var s = gd.sheeps[gd.curSid];
        var out = "<b>  <input id='sname' type='text' value='" + s.name + "' onchange='renamesheep()' /></b> - #" + s.id;
        out += ` <button onclick='prevsheep()'>prev</button><button onclick="nextsheep()">next</button>
   `;
        out += "<BR>" + ((s.female)? "female" : "male") + ", " + s.age + " weeks old<BR>";
            if (s.sx || s.sy) { out += "solid "} else {out += "spotted "}
            if (s.cx || s.cy) { out += "gray"} else {out += "white"}
       
           
            out += "<BR><HR>Assigned pasture: ";
        out += `<button onclick='selectandviewpasture(` + s.pid + `)' > ` + gd.pastures[s.pid].name  +`</button>
        Move to <select id="pmselector" oninput='changeSheepPastureMenu()'>
        <option ` + (s.pid==0 ? "selected" : "") + ` id='ps0'>` + gd.pastures[0].name + `</option>
        <option ` + (s.pid==1 ? "selected" : "") + ` id='ps1'>` + gd.pastures[1].name + `</option>
        <option ` + (s.pid==2 ? "selected" : "") + ` id='ps2'>` + gd.pastures[2].name + `</option>
        <option ` + (s.pid==3 ? "selected" : "") + ` id='ps3'>` + gd.pastures[3].name + `</option>
        </select>
        `;

        //out += "spotg: " + s.sx + "," + s.sy + "<BR>";
        //out +="colorg: " +  s.cx + "," + s.cy + "<BR>";
       
        
        
        

        tb.innerHTML = out;
        return out;
    }

    function renamesheep(){
        var sn = document.getElementById("sname").value;
        gd.sheeps[gd.curSid].name = sn;

    }

    function renamepasture(){
        var pn = document.getElementById("pname").value;
        gd.pastures[gd.curPid].name = pn;
        clickTab(1);
    }



    function addNewSheep(){
        var s = new sheep( )
        log("baa! made " + s.name);
        gd.sheeps[s.id] = s;
        gd.pastures[gd.curPid].heldSheepIds.push(s.id);
       s.pid = gd.curPid;
       gd.curSid = s.id;
       sc.innerHTML = "Total Sheep: " + gd.sheeps.length;
        
    }


    function breedSheep(s1, s2){

        bcx = randfrom([s1.cx,s2.cx]);
        bcy = randfrom([s1.cy,s2.cy]);
        bsx = randfrom([s1.sx,s2.sx]);
        bsy = randfrom([s1.sy,s2.sy]);

        var bs = new sheep(bcx,bcy,bsx,bsy);
        log("baa! made " + bs.name);
        gd.curPid = s1.pid;
        gd.sheeps[bs.id] = bs;
        gd.pastures[gd.curPid].heldSheepIds.push(bs.id);
       bs.pid = gd.curPid;
       gd.curSid = bs.id;
       sc.innerHTML = "Total Sheep: " + gd.sheeps.length;

    }



    function breedall(){
        
    }

    function moveSheep(sid, newpid){
        newpid = Math.min(newpid,gd.pastures.length-1)
        newpid = Math.max(0,newpid);
        var s = gd.sheeps[sid];
        var oldpid = s.pid;
        rem(gd.pastures[s.pid].heldSheepIds, sid)
        gd.pastures[newpid].heldSheepIds.push(sid);
        s.pid = newpid;
        log("moved " + s.name + " from " + gd.pastures[oldpid].name + " to " + gd.pastures[newpid].name);
        
        clickTab(2);
    }

    function renderPastureList(pid){
        var out = "<ul class='tree-view altlist'>";
        var p = gd.pastures[pid];
        for (let si of p.heldSheepIds){
            var s = gd.sheeps[si];
            out +=  "<li onclick='selectandviewsheep(" + s.id + ")'>" + s.id + " -" + s.name + "</li>";
        }
        out += "</ul>"
        return out;
    }

    function renderAllSheepList(){
        var out = "";
        out += "All Sheep" + "<BR><HR><ul class='tree-view' style='height:15em;overflow-y:scroll;width:50%;'>";
        for (let p of gd.pastures){
            out += "<li ><details><summary><button onclick='selectandviewpasture(" + p.id + ")'>" + p.name + "</button> </summary><ul>";


            for (let si of p.heldSheepIds){
                var s = gd.sheeps[si];
                out += "<li onclick='selectandviewsheep(" + s.id + ")'>" + s.id + " - " + s.name + "</li>";

            }


            out += "</ul></details></li>"
        }
        out += "</ul>"
        return out;
    }

    function renderSheep(sid){
        var out = "";
        var s = gd.sheeps[sid];
        out += s.id + " - " + s.name + "<br><hr><BR>";
        out += "age: " + s.age + "<BR>";
       
        return out;
    }




    // models

    function gameData(){
        this.sheepIndex = 0;
        this.curPid = 0;
        this.curSid = 0;
        this.pastures = [];
        this.pastures.push(new pasture(0));
        this.pastures.push(new pasture(1));
        this.pastures.push(new pasture(2));
        this.pastures.push(new pasture(3));
        this.sheeps = [];
    }


    function pasture(pid){
        this.id = pid;
        this.name = "Pasture " + (this.id+1);
        this.heldSheepIds = []
        this.maxSheep = 12;
    }
   

   function sheep( cx = -1, cy = -1, sx = -1, sy = -1, g1 = -1, g2 = -1, g3 = -1, ){
    
    this.id = gd.sheepIndex;
    gd.sheepIndex+=1;
    this.name = "sheep"+this.id;
    this.cx = cx;
    this.cy = cy;
    this.sx = sx;
    this.sy = sy;
    if (cx == -1) this.cx = ((randint(0,10)>5));
    if (cy == -1) this.cy = ((randint(0,10)>5));
    if (sx == -1) this.sx = ((randint(0,10)>3));
    if (sy == -1) this.sy = ((randint(0,10)>3));
    this.pid = gd.curPid;
    this.age = 0;
    this.female = ((randint(0,10)>5));
    this.g1 = g1;
    this.g2 = g2;
    this.g3 = g3;
    if (g1 == -1) this.g1 = randint(0,10);
    if (g2 == -1) this.g2 = randint(0,10);
    if (g3 == -1) this.g3 = randint(0,10);
    this.dv = Math.random();
    
    
   }

        //utility

function log(s){
    console.log(s);
}

 function randint(min, max) {
  return Math.floor(Math.random() * (max - min + 1) ) + min;

  
}

function randfrom(myarray){
		return myarray[Math.floor(Math.random() * myarray.length)];
	}

function rem(a, ele) {
    a.forEach((item, index) => {
        if (item === ele) {
            a.splice(index, 1);
        }
    });
    return a;
}

    </script>
    </body>
</html>